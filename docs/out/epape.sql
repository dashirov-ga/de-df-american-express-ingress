

CREATE TABLE imported.american_express_epape_summary (
  "SETTLEMENT_SE_ACCOUNT_NUMBER" NUMERIC(18,0) NOT NULL,
  "SETTLEMENT_ACCOUNT_NAME_CODE" NUMERIC(18,0) NOT NULL,
  "SETTLEMENT_DATE" DATE NOT NULL SORTKEY,
  "RECORD_CODE" INTEGER NOT NULL,
  "RECORD_SUB_CODE" INTEGER NOT NULL,
  "SETTLEMENT_AMOUNT" NUMERIC(18,2) NOT NULL,
  "SE_BANK_SORT_CODE" DECIMAL,
  "SE_BANK_ACCOUNT_NUMBER" DECIMAL,
  "SETTLEMENT_GROSS_AMOUNT" NUMERIC(18,2) NOT NULL,
  "TAX_AMOUNT" NUMERIC(18,2) NOT NULL,
  "TAX_RATE" NUMERIC(18,2) NOT NULL,
  "SERVICE_FEE_AMOUNT" NUMERIC(18,2) NOT NULL,
  "SERVICE_FEE_RATE" NUMERIC(18,2) NOT NULL,
  "SETTLEMENT_ADJUSTMENT_AMOUNT" NUMERIC(18,2) NOT NULL,
  "PAY_PLAN_SHORT_NAME" VARCHAR(10),
  "PAYEE_NAME" VARCHAR(50) NOT NULL,
  "SETTLEMENT_ACCOUNT_NAME_CODE_EXTENDED" VARCHAR(50) NOT NULL,
  "SETTLEMENT_CURRENCY_CODE" VARCHAR(3) NOT NULL,
  "PREVIOUS_DEBIT_BALANCE" NUMERIC(18,2) NOT NULL,
  "IBAN" VARCHAR(20),
  "BIC" VARCHAR(20),
  "GENERATED_PAYMENT_NUMBER" VARCHAR(36) NOT NULL PRIMARY KEY DISTKEY
)
  DISTSTYLE KEY;

-- NEED A PRIMARY KEY FOR THIS. USE NEXUS? CHECKSUM?
CREATE TABLE imported.american_express_epape_adjustment_detail (
  "SETTLEMENT_SE_ACCOUNT_NUMBER" NUMERIC(18,0) NOT NULL,
  "SETTLEMENT_ACCOUNT_NAME_CODE" NUMERIC(18,0) NOT NULL,
  "SETTLEMENT_DATE" DATE NOT NULL SORTKEY ,
  "SUBMISSION_SE_ACCOUNT_NUMBER" NUMERIC(18,0) NOT NULL,
  "RECORD_CODE" INTEGER NOT NULL,
  "RECORD_SUB_CODE" INTEGER NOT NULL,
  "SUPPORTING_REFERENCE_NUMBER" VARCHAR(50) NOT NULL, -- primary key?
  "SETTLEMENT_GROSS_AMOUNT" NUMERIC(18,2) NOT NULL,
  "SETTLEMENT_DISCOUNT_AMOUNT" NUMERIC(18,2) NOT NULL,
  "SETTLEMENT_NET_AMOUNT" NUMERIC(18,2) NOT NULL,
  "SERVICE_FEE_RATE" NUMERIC(18,2) NOT NULL,
  "SETTLEMENT_TAX_AMOUNT" NUMERIC(18,2) NOT NULL,
  "SETTLEMENT_TAX_RATE" NUMERIC(18,2) NOT NULL,
  "CARD_MEMBER_ACCOUNT_NUMBER" VARCHAR(20) NOT NULL,
  "ADJUSTMENT_RECORD_MESSAGE_CODE" VARCHAR(50) NOT NULL,
  "ADJUSTMENT_MESSAGE_DESCRIPTION" VARCHAR(50) NOT NULL,
  "SUBMISSION_SE_BRANCH_NUMBER" VARCHAR(100),
  "SUBMISSION_GROSS_AMOUNT" NUMERIC(18,2) NOT NULL,
  "SUBMISSION_CURRENCY_CODE" VARCHAR(3) NOT NULL,
  "ADJUSTMENT_MESSAGE_REFERENCE" VARCHAR(100),
  "GENERATED_PAYMENT_NUMBER" VARCHAR(36) NOT NULL DISTKEY,
  FOREIGN KEY ("GENERATED_PAYMENT_NUMBER" )
  REFERENCES imported.american_express_epape_summary ("GENERATED_PAYMENT_NUMBER")
)
  DISTSTYLE KEY;

CREATE TABLE imported.american_express_epape_summary_of_charge_detail (
  "SETTLEMENT_SE_ACCOUNT_NUMBER" NUMERIC(18,0) NOT NULL,
  "SETTLEMENT_ACCOUNT_NAME_CODE" NUMERIC(18,0) NOT NULL,
  "SETTLEMENT_DATE" DATE NOT NULL,
  "SUBMISSION_SE_ACCOUNT_NUMBER" NUMERIC(18,2) NOT NULL,
  "RECORD_CODE" INTEGER NOT NULL,
  "RECORD_SUB_CODE" INTEGER NOT NULL,
  "SOC_DATE" DATE NOT NULL,
  "SUBMISSION_CALCULATED_GROSS_AMOUNT" NUMERIC(18,2) NOT NULL,
  "SUBMISSION_DECLARED_GROSS_AMOUNT" NUMERIC(18,2) NOT NULL,
  "DISCOUNT_AMOUNT" NUMERIC(18,2) NOT NULL,
  "SETTLEMENT_NET_AMOUNT" NUMERIC(18,2) NOT NULL,
  "SERVICE_FEE_RATE" NUMERIC(18,2) NOT NULL,
  "SETTLEMENT_GROSS_AMOUNT" NUMERIC(18,2) NOT NULL,
  "ROC_CALCULATED_COUNT" INTEGER NOT NULL,
  "SETTLEMENT_TAX_AMOUNT" NUMERIC(18,2) NOT NULL,
  "SETTLEMENT_TAX_RATE" NUMERIC(18,8) NOT NULL,
  "SUBMISSION_CURRENCY_CODE" VARCHAR(3) NOT NULL,
  "SUBMISSION_NUMBER" DECIMAL NOT NULL,
  "SUBMISSION_SE_BRANCH_NUMBER" VARCHAR(100),
  "SUBMISSION_METHOD_CODE" VARCHAR(1) NOT NULL,
  "EXCHANGE_RATE" NUMERIC(18,8) NOT NULL,
  "GENERATED_PAYMENT_NUMBER" VARCHAR(36) NOT NULL DISTKEY,
  "GENERATED_SOC_NUMBER" VARCHAR(36) NOT NULL PRIMARY KEY,
  FOREIGN KEY ("GENERATED_PAYMENT_NUMBER" )
  REFERENCES imported.american_express_epape_summary ("GENERATED_PAYMENT_NUMBER")

)
  DISTSTYLE KEY;


CREATE TABLE imported.american_express_epape_record_of_charge_detail (
  "SETTLEMENT_SE_ACCOUNT_NUMBER" NUMERIC(18,0) NOT NULL,
  "SETTLEMENT_ACCOUNT_NAME_CODE" NUMERIC(18,0) NOT NULL,
  "SUBMISSION_SE_ACCOUNT_NUMBER" NUMERIC(18,0) NOT NULL,
  "RECORD_CODE" INTEGER NOT NULL,
  "RECORD_SUB_CODE" INTEGER NOT NULL,
  "CHARGE_AMOUNT" NUMERIC(18,2) NOT NULL,
  "CHARGE_DATE" DATE NOT NULL SORTKEY,
  "ROC_REFERENCE_NUMBER" VARCHAR(20) NOT NULL PRIMARY KEY,
  "ROC_REFERENCE_NUMBER_CPC_ONLY" VARCHAR(20),
  "THREE_DIGIT_CHARGE_AUTHORIZATION_CODE" VARCHAR(3),
  "CARD_MEMBER_ACCOUNT_NUMBER" VARCHAR(20) NOT NULL,
  "AIRLINE_TICKET_NUMBER" VARCHAR(20) NOT NULL,
  "SIX_DIGIT_CHARGE_AUTHORIZATION_CODE" VARCHAR(6),
  "GENERATED_PAYMENT_NUMBER" VARCHAR(36) NOT NULL DISTKEY,
  "GENERATED_SOC_NUMBER" VARCHAR(36) NOT NULL,
  FOREIGN KEY ("GENERATED_PAYMENT_NUMBER" )
  REFERENCES imported.american_express_epape_summary ("GENERATED_PAYMENT_NUMBER"),
  FOREIGN KEY ("GENERATED_SOC_NUMBER" )
  REFERENCES imported.american_express_epape_summary_of_charge_detail ("GENERATED_SOC_NUMBER")
)
  DISTSTYLE KEY;

